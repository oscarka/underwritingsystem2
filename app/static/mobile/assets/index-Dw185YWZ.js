import{d as A,p as K,r as y,q as g,v as L,f as n,c as l,g as m,h as c,x as f,y as M,F as _,z as h,A as V,n as N,k as O,l as P,o as t,w as S,j as B,t as z}from"./index-Mvle93cn.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";const H={class:"disease-page"},J={class:"disease-content"},Q={class:"disease-tags"},W={key:3,class:"selected-diseases"},X={class:"disease-tags"},Y={class:"submit-bar"},Z=A({__name:"index",setup(ee){const I=O(),$=P(),i=K(),u=y([]),o=y(!1),d=y(""),k=async()=>{o.value=!0;try{u.value=await V.getDiseases()}catch(e){console.error("加载疾病列表失败:",e),N({type:"fail",message:"加载疾病列表失败"})}finally{o.value=!1}},j=async()=>{if(!d.value){await k();return}o.value=!0;try{u.value=await V.searchDiseases(d.value)}catch(e){console.error("搜索疾病失败:",e),N({type:"fail",message:"搜索疾病失败"})}finally{o.value=!1}},q=g(()=>{const e={};return u.value.forEach(s=>{e[s.category]||(e[s.category]=[]),e[s.category].push(s)}),Object.entries(e).map(([s,p])=>({name:s,diseases:p}))}),v=g(()=>i.selectedDiseases),b=e=>v.value.some(s=>s.id===e.id),E=e=>{b(e)?i.removeDisease(e.id):i.addDisease(e)},F=e=>{i.removeDisease(e.id)},D=g(()=>v.value.length>0),R=()=>{if(D.value){const e=$.params.productId;I.push(`/product/${e}/questions`)}};return L(()=>{k()}),(e,s)=>{const p=c("van-search"),x=c("van-skeleton"),T=c("van-empty"),w=c("van-cell"),C=c("van-tag"),U=c("van-submit-bar");return t(),n("div",H,[l(p,{modelValue:d.value,"onUpdate:modelValue":[s[0]||(s[0]=a=>d.value=a),j],placeholder:"搜索疾病名称"},null,8,["modelValue"]),m("div",J,[o.value?(t(),n(_,{key:0},[l(x,{title:"",row:3}),l(x,{title:"",row:3})],64)):u.value.length===0?(t(),f(T,{key:1,description:"暂无疾病数据"})):(t(!0),n(_,{key:2},h(q.value,a=>(t(),n("div",{key:a.name,class:"disease-category"},[l(w,{title:a.name},null,8,["title"]),m("div",Q,[(t(!0),n(_,null,h(a.diseases,r=>(t(),f(C,{key:r.id,type:b(r)?"primary":"default",size:"medium",onClick:se=>E(r),class:"disease-tag"},{default:S(()=>[B(z(r.name),1)]),_:2},1032,["type","onClick"]))),128))])]))),128)),v.value.length>0?(t(),n("div",W,[l(w,{title:"已选择的疾病"}),m("div",X,[(t(!0),n(_,null,h(v.value,a=>(t(),f(C,{key:a.id,type:"primary",size:"medium",closeable:"",onClose:r=>F(a),class:"disease-tag"},{default:S(()=>[B(z(a.name),1)]),_:2},1032,["onClose"]))),128))])])):M("",!0)]),m("div",Y,[l(U,{"button-text":o.value?"加载中...":"下一步",loading:o.value,disabled:!D.value,onSubmit:R},null,8,["button-text","loading","disabled"])])])}}}),oe=G(Z,[["__scopeId","data-v-ce01f166"]]);export{oe as default};
