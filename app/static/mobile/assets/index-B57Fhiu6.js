import{d as T,p as z,r as y,v as D,f as m,x as l,F as f,c,h as n,w as o,n as U,j as _,g as E,z as g,y as L,t as V,k as M,o as a}from"./index-BHr1Dggr.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";const $={class:"questions-page"},G={class:"form-actions"},H=T({__name:"index",setup(J){const k=M(),h=z(),b=y([]),u=y({}),r=y(!1),i=y(null),x=async()=>{r.value=!0,i.value=null;try{const s=await h.loadQuestions();b.value=s}catch(s){i.value="加载问题失败，请重试",console.error("加载问题失败:",s),U({type:"fail",message:"加载问题失败"})}finally{r.value=!1}},C=async()=>{if(!r.value){r.value=!0;try{const s=k.currentRoute.value.params.productId,d=Object.entries(u.value).map(([v,p])=>({questionId:Number(v),answer:p}));await h.submitAnswers(d),k.push(`/product/${s}/result`)}catch(s){console.error("提交答案失败:",s),U({type:"fail",message:"提交失败，请重试"})}finally{r.value=!1}}},B=()=>{k.push("/disease")};return D(()=>{x()}),(s,d)=>{const v=n("van-skeleton"),p=n("van-button"),w=n("van-empty"),N=n("van-radio"),I=n("van-radio-group"),S=n("van-checkbox"),j=n("van-checkbox-group"),A=n("van-stepper"),F=n("van-field"),Q=n("van-cell-group"),R=n("van-form");return a(),m("div",$,[r.value?(a(),m(f,{key:0},[c(v,{title:"",row:3}),c(v,{title:"",row:3})],64)):i.value?(a(),l(w,{key:1,image:"error",description:i.value},{bottom:o(()=>[c(p,{round:"",type:"primary",onClick:x},{default:o(()=>d[0]||(d[0]=[_(" 重试 ")])),_:1})]),_:1},8,["description"])):b.value.length?(a(),l(R,{key:3,onSubmit:C},{default:o(()=>[(a(!0),m(f,null,g(b.value,e=>(a(),l(Q,{inset:"",key:e.id},{default:o(()=>[c(F,{name:"question_"+e.id,label:e.content,rules:[{required:e.required,message:"此题为必答题"}]},{input:o(()=>[e.type==="single"?(a(),l(I,{key:0,modelValue:u.value[e.id],"onUpdate:modelValue":t=>u.value[e.id]=t},{default:o(()=>[(a(!0),m(f,null,g(e.options,t=>(a(),l(N,{key:t.id,name:t.value},{default:o(()=>[_(V(t.label),1)]),_:2},1032,["name"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):e.type==="multiple"?(a(),l(j,{key:1,modelValue:u.value[e.id],"onUpdate:modelValue":t=>u.value[e.id]=t},{default:o(()=>[(a(!0),m(f,null,g(e.options,t=>(a(),l(S,{key:t.id,name:t.value,shape:"square"},{default:o(()=>[_(V(t.label),1)]),_:2},1032,["name"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):e.type==="number"?(a(),l(A,{key:2,modelValue:u.value[e.id],"onUpdate:modelValue":t=>u.value[e.id]=t},null,8,["modelValue","onUpdate:modelValue"])):L("",!0)]),_:2},1032,["name","label","rules"])]),_:2},1024))),128)),E("div",G,[c(p,{round:"",block:"",type:"primary","native-type":"submit",loading:r.value},{default:o(()=>[_(V(r.value?"提交中...":"提交"),1)]),_:1},8,["loading"])])]),_:1})):(a(),l(w,{key:2,description:"暂无问题需要回答"},{bottom:o(()=>[c(p,{round:"",type:"primary",onClick:B},{default:o(()=>d[1]||(d[1]=[_(" 返回选择疾病 ")])),_:1})]),_:1}))])}}}),W=O(H,[["__scopeId","data-v-507b38bc"]]);export{W as default};
