import{d as I,k as q,a as h,y as S,b as p,e as i,g as n,w as u,D as U,t as b,A,aA as R,r as c,o as _,i as w,F as x,f as k}from"./vue-vendor-hvhEjQgQ.js";import{u as T}from"./useMessage-CiNUiv7K.js";import{a as M,b as L,e as $,u as j,c as z}from"./underwriting-WGKpY2Tf.js";import{_ as G}from"./index-soUPKp6E.js";const H={class:"ai-parameter-edit-page"},J={class:"page-header"},K={class:"header-left"},O={class:"header-actions"},Q={class:"form-container"},W=["value"],X=["value"],Y=I({__name:"AIParameterEditView",setup(Z){const f=A(),v=R(),d=T(),y=q(()=>v.params.id!==void 0),a=h({name:"",parameter_type_id:void 0,rule_id:void 0,value:"",description:void 0}),V=h([]),B=h([]),N=async()=>{try{const t=await M();V.value=t.data}catch(t){console.error("获取参数类型失败:",t),d.error("获取参数类型失败")}},D=async()=>{try{const t=await L();B.value=t.data}catch(t){console.error("获取规则列表失败:",t),d.error("获取规则列表失败")}},P=async()=>{if(y.value)try{const e=(await $(Number(v.params.id))).data;a.value={name:e.name,parameter_type_id:e.parameter_type_id,rule_id:e.rule_id,value:e.value,description:e.description}}catch(t){console.error("获取参数详情失败:",t),d.error("获取参数详情失败")}},C=()=>{const{name:t,parameter_type_id:e,rule_id:s,value:l}=a.value,o=[];t!=null&&t.trim()?t.length>100&&o.push("参数名称不能超过100个字符"):o.push("参数名称不能为空"),e||o.push("参数类型不能为空"),s||o.push("核保规则不能为空"),l!=null&&l.trim()?l.length>500&&o.push("参数值不能超过500个字符"):o.push("参数值不能为空");const m=a.value.description;return m&&m.length>500&&o.push("参数描述不能超过500个字符"),o.length>0?(o.forEach(g=>d.error(g)),!1):(a.value.parameter_type_id=Number(e),a.value.rule_id=Number(s),!0)},E=async()=>{var t,e;if(C())try{console.log("准备保存数据:",a.value);const s={...a.value,parameter_type_id:Number(a.value.parameter_type_id),rule_id:Number(a.value.rule_id),status:"enabled"};if(console.log("处理后的提交数据:",s),y.value){const l=await j(Number(v.params.id),s);if(l.code===200)d.success("更新成功"),f.push({path:"/underwriting/ai-parameter",query:{refresh:Date.now().toString()}});else throw new Error(l.message||"更新失败")}else{const l=await z(s);if(l.code===200)d.success("创建成功"),f.push({path:"/underwriting/ai-parameter",query:{refresh:Date.now().toString()}});else throw new Error(l.message||"创建失败")}}catch(s){console.error("保存失败:",s),d.error(((e=(t=s.response)==null?void 0:t.data)==null?void 0:e.message)||s.message||"保存失败")}},F=()=>{f.back()};return S(()=>{N(),D(),P()}),(t,e)=>{const s=c("BaseButton"),l=c("BaseInput"),o=c("BaseFormItem"),m=c("BaseSelect"),g=c("BaseForm");return _(),p("div",H,[i("div",J,[i("div",K,[n(s,{onClick:e[0]||(e[0]=r=>U(f).back())},{default:u(()=>e[6]||(e[6]=[w("返回")])),_:1}),i("h1",null,b(y.value?"编辑智核参数":"新增智核参数"),1)]),i("div",O,[n(s,{onClick:F},{default:u(()=>e[7]||(e[7]=[w("取消")])),_:1}),n(s,{type:"primary",onClick:E},{default:u(()=>e[8]||(e[8]=[w("保存")])),_:1})])]),i("div",Q,[n(g,{ref:"form",model:a.value,"label-width":"120px"},{default:u(()=>[n(o,{label:"参数名称",required:""},{default:u(()=>[n(l,{modelValue:a.value.name,"onUpdate:modelValue":e[1]||(e[1]=r=>a.value.name=r),placeholder:"请输入参数名称",maxlength:100},null,8,["modelValue"])]),_:1}),n(o,{label:"参数类型",required:""},{default:u(()=>[n(m,{modelValue:a.value.parameter_type_id,"onUpdate:modelValue":e[2]||(e[2]=r=>a.value.parameter_type_id=r),placeholder:"请选择参数类型"},{default:u(()=>[e[9]||(e[9]=i("option",{value:"",disabled:""},"请选择参数类型",-1)),(_(!0),p(x,null,k(V.value,r=>(_(),p("option",{key:r.id,value:r.id},b(r.name),9,W))),128))]),_:1},8,["modelValue"])]),_:1}),n(o,{label:"核保规则",required:""},{default:u(()=>[n(m,{modelValue:a.value.rule_id,"onUpdate:modelValue":e[3]||(e[3]=r=>a.value.rule_id=r),placeholder:"请选择核保规则"},{default:u(()=>[e[10]||(e[10]=i("option",{value:"",disabled:""},"请选择核保规则",-1)),(_(!0),p(x,null,k(B.value,r=>(_(),p("option",{key:r.id,value:r.id},b(r.name),9,X))),128))]),_:1},8,["modelValue"])]),_:1}),n(o,{label:"参数值",required:""},{default:u(()=>[n(l,{modelValue:a.value.value,"onUpdate:modelValue":e[4]||(e[4]=r=>a.value.value=r),type:"textarea",placeholder:"请输入参数值",maxlength:500,rows:4},null,8,["modelValue"])]),_:1}),n(o,{label:"参数描述"},{default:u(()=>[n(l,{modelValue:a.value.description,"onUpdate:modelValue":e[5]||(e[5]=r=>a.value.description=r),type:"textarea",placeholder:"请输入参数描述",maxlength:500,rows:4},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])])}}}),oe=G(Y,[["__scopeId","data-v-f2bf02e6"]]);export{oe as default};
//# sourceMappingURL=AIParameterEditView-BM_2huWk.js.map
