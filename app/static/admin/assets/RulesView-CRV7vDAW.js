import{d as te,a as i,x as D,y as ne,b as c,e as l,g as t,w as m,F as L,f as E,A as re,r as b,o as p,i as g,t as f,n as de,c as ie,l as N}from"./vue-vendor-hvhEjQgQ.js";import{r as h}from"./underwriting-WGKpY2Tf.js";import{s as ue,_ as me}from"./index-soUPKp6E.js";const pe={class:"rules-page"},ce={class:"page-header"},ve={class:"header-actions"},ge={class:"search-bar"},fe={class:"rules-table"},ye={key:0,class:"loading-wrapper"},Ve={key:1,class:"empty-state"},we={key:2},ke={class:"action-buttons"},Ce={class:"pagination"},he={class:"form"},Re={class:"form-item"},xe={key:0,class:"form-error"},be={class:"form-item"},Be={key:0,class:"form-error"},Ue={class:"form-item"},_e={class:"form"},ze={class:"form-item"},Se=te({__name:"RulesView",props:{confirmLoading:{type:Boolean,default:!1},onNodeUnmounted:{type:Function,default:()=>{}}},setup(Ie){const M=re(),z=i(!1),B=i(!1),U=i(!1),y=i("add"),d=i(null),S=i(!1),n=D({name:"",version:"",remark:""}),V=D({name:"",version:""}),v=i(""),O=[{label:"已导入",value:"已导入"},{label:"已启用",value:"已启用"},{label:"已禁用",value:"已禁用"}],F=i([]),r=D({name:"",status:void 0,diseaseCategory:void 0,page:1,pageSize:10}),I=i(1),$=i(10),_=i(0),R=i([]),o=a=>{ue(a.type,a.message)},w=async()=>{console.log("开始加载核保规则列表:",r),z.value=!0;try{const a=await h.getRules(r);console.log("核保规则响应:",a),a.code===200?(R.value=a.data.list||[],_.value=a.data.total||0,console.log("核保规则加载成功:",{list:R.value,total:_.value})):(console.error("加载核保规则失败:",a.message),o({type:"error",message:a.message||"加载失败"}),R.value=[],_.value=0)}catch(a){console.error("加载核保规则列表失败:",a),o({type:"error",message:a.message||"加载失败"}),R.value=[],_.value=0}finally{z.value=!1}},T=async()=>{try{const a=await h.getDiseaseCategories("all");a.code===200&&a.data?F.value=a.data.map(e=>({label:e.name,value:e.code})):o({type:"error",message:a.message||"获取疾病类别失败"})}catch{o({type:"error",message:"获取疾病类别失败"})}},P=()=>{r.page=1,w()},j=()=>{r.name="",r.status=void 0,r.diseaseCategory=void 0,r.page=1,w()},Q=()=>{r.page=I.value,r.pageSize=$.value,w()},q=()=>{y.value="add",n.name="",n.version="",n.remark="",B.value=!0},G=a=>{y.value="edit",v.value=a.id,n.name=a.name,n.version=a.version,n.remark=a.remark||"",B.value=!0},H=a=>{console.log("[RulesView] 点击查看按钮:",{id:a.id,name:a.name,version:a.version}),M.push(`/underwriting/rules/${a.id}/detail`)},J=a=>{console.log("[RulesView] 点击查看规则按钮:",{id:a.id,name:a.name,version:a.version}),M.push(`/underwriting/rules/${a.id}/detail`)},K=async a=>{try{const e=await h.exportRuleData(a.id);if(e.code===200&&e.data){const u=new Blob([e.data],{type:"application/vnd.ms-excel"}),k=window.URL.createObjectURL(u),x=document.createElement("a");x.href=k,x.download=`${a.name}-${a.version}.xlsx`,x.click(),window.URL.revokeObjectURL(k),o({type:"success",message:"导出成功"})}else o({type:"error",message:e.message||"导出失败"})}catch{o({type:"error",message:"导出失败"})}},W=a=>{console.log("[RulesView] 点击导入按钮:",{id:a.id,name:a.name,version:a.version}),v.value=a.id,d.value=null,U.value=!0},X=async()=>{var a;if(console.log("[RulesView] 确认导入:",{ruleId:v.value,hasFile:!!d.value,fileName:(a=d.value)==null?void 0:a.name}),!d.value){o({type:"error",message:"请选择要导入的文件"});return}if(!v.value){o({type:"error",message:"未找到规则ID"});return}try{S.value=!0,console.log("[RulesView] 开始导入规则数据:",{ruleId:v.value,fileName:d.value.name,fileSize:d.value.size,fileType:d.value.type});const e=await h.importRuleData(v.value,d.value);console.log("[RulesView] 导入响应:",{code:e.code,message:e.message}),e.code===200?(o({type:"success",message:"导入成功"}),U.value=!1,d.value=null,v.value="",await w()):o({type:"error",message:e.message||"导入失败"})}catch(e){console.error("[RulesView] 导入失败:",e),o({type:"error",message:(e==null?void 0:e.message)||"导入失败"})}finally{S.value=!1}},Y=()=>{console.log("[RulesView] 取消导入"),U.value=!1,d.value=null,v.value=""},Z=async()=>{if(V.name=n.name?"":"请输入规则名称",V.version=n.version?"":"请输入版本号",!(V.name||V.version))try{let a;y.value==="add"?a=await h.createRule(n):a=await h.updateRule(v.value,n),a.code===200?(o({type:"success",message:y.value==="add"?"新增成功":"编辑成功"}),B.value=!1,w()):o({type:"error",message:a.message||(y.value==="add"?"新增失败":"编辑失败")})}catch{o({type:"error",message:y.value==="add"?"新增失败":"编辑失败"})}},ee=async a=>{try{if(!confirm(`确认删除规则"${a.name}"吗？`))return;console.log("[RulesView] 开始删除规则:",{id:a.id,name:a.name}),(await h.deleteRule(a.id)).code===200&&(o({type:"success",message:"删除成功"}),w())}catch(e){console.error("[RulesView] 删除规则失败:",e),o({type:"error",message:"删除失败"})}},ae=a=>{switch(a){case"已启用":return"success";case"已导入":return"processing";case"草稿":return"default";case"已禁用":return"error";default:return"default"}},le=a=>{console.log("[RulesView] 文件上传错误:",a),o({type:"error",message:a.message})};return ne(()=>{w(),T()}),(a,e)=>{const u=b("BaseButton"),k=b("BaseInput"),x=b("BaseSelect"),se=b("BasePagination"),A=b("BaseModal"),oe=b("BaseUpload");return p(),c("div",pe,[l("div",ce,[e[12]||(e[12]=l("h1",null,"核保规则管理",-1)),l("div",ve,[t(u,{type:"primary",onClick:q},{default:m(()=>e[11]||(e[11]=[g("新增规则")])),_:1})])]),l("div",ge,[t(k,{modelValue:r.name,"onUpdate:modelValue":e[0]||(e[0]=s=>r.name=s),placeholder:"搜索规则名称",style:{width:"300px"}},null,8,["modelValue"]),t(x,{modelValue:r.status,"onUpdate:modelValue":e[1]||(e[1]=s=>r.status=s),options:O,placeholder:"规则状态",style:{width:"200px"}},null,8,["modelValue"]),t(x,{modelValue:r.diseaseCategory,"onUpdate:modelValue":e[2]||(e[2]=s=>r.diseaseCategory=s),options:F.value,placeholder:"疾病类别",style:{width:"200px"}},null,8,["modelValue","options"]),t(u,{onClick:P},{default:m(()=>e[13]||(e[13]=[g("搜索")])),_:1}),t(u,{onClick:j},{default:m(()=>e[14]||(e[14]=[g("重置")])),_:1})]),l("div",fe,[z.value?(p(),c("div",ye,[(p(),c(L,null,E(5,s=>l("div",{class:"skeleton-row",key:s},[(p(),c(L,null,E(6,C=>l("div",{class:"skeleton-cell",key:C})),64))])),64))])):R.value.length?(p(),c("table",we,[e[22]||(e[22]=l("thead",null,[l("tr",null,[l("th",null,"ID"),l("th",null,"核保规则名称"),l("th",null,"核保规则版本"),l("th",null,"规则状态"),l("th",null,"备注"),l("th",null,"创建时间"),l("th",null,"编辑时间"),l("th",null,"操作")])],-1)),l("tbody",null,[(p(!0),c(L,null,E(R.value,s=>(p(),c("tr",{key:s.id},[l("td",null,f(s.id),1),l("td",null,f(s.name),1),l("td",null,f(s.version),1),l("td",null,[l("span",{class:de(["status-badge",ae(s.status)])},f(s.status),3)]),l("td",null,f(s.remark||"-"),1),l("td",null,f(s.createdAt),1),l("td",null,f(s.updatedAt),1),l("td",null,[l("div",ke,[t(u,{size:"small",onClick:C=>H(s)},{default:m(()=>e[16]||(e[16]=[g("查看")])),_:2},1032,["onClick"]),t(u,{size:"small",onClick:C=>J(s)},{default:m(()=>e[17]||(e[17]=[g("查看规则")])),_:2},1032,["onClick"]),t(u,{size:"small",onClick:C=>G(s)},{default:m(()=>e[18]||(e[18]=[g("编辑")])),_:2},1032,["onClick"]),t(u,{size:"small",onClick:C=>W(s)},{default:m(()=>e[19]||(e[19]=[g("导入")])),_:2},1032,["onClick"]),s.has_data?(p(),ie(u,{key:0,size:"small",onClick:C=>K(s)},{default:m(()=>e[20]||(e[20]=[g("导出")])),_:2},1032,["onClick"])):N("",!0),t(u,{size:"small",type:"danger",onClick:C=>ee(s)},{default:m(()=>e[21]||(e[21]=[g("删除")])),_:2},1032,["onClick"])])])]))),128))])])):(p(),c("div",Ve,e[15]||(e[15]=[l("span",{class:"icon"},"📭",-1),l("p",null,"暂无数据",-1)]))),l("div",Ce,[t(se,{current:I.value,"onUpdate:current":e[3]||(e[3]=s=>I.value=s),pageSize:$.value,"onUpdate:pageSize":e[4]||(e[4]=s=>$.value=s),total:_.value,onChange:Q},null,8,["current","pageSize","total"])])]),t(A,{modelValue:B.value,"onUpdate:modelValue":e[8]||(e[8]=s=>B.value=s),title:y.value==="add"?"新增规则":"编辑规则",width:"500px",onConfirm:Z},{default:m(()=>[l("div",he,[l("div",Re,[e[23]||(e[23]=l("label",null,"规则名称",-1)),t(k,{modelValue:n.name,"onUpdate:modelValue":e[5]||(e[5]=s=>n.name=s),placeholder:"请输入规则名称",maxlength:50},null,8,["modelValue"]),V.name?(p(),c("div",xe,f(V.name),1)):N("",!0)]),l("div",be,[e[24]||(e[24]=l("label",null,"版本号",-1)),t(k,{modelValue:n.version,"onUpdate:modelValue":e[6]||(e[6]=s=>n.version=s),placeholder:"请输入版本号",maxlength:30,disabled:y.value==="edit"},null,8,["modelValue","disabled"]),V.version?(p(),c("div",Be,f(V.version),1)):N("",!0)]),l("div",Ue,[e[25]||(e[25]=l("label",null,"备注",-1)),t(k,{modelValue:n.remark,"onUpdate:modelValue":e[7]||(e[7]=s=>n.remark=s),type:"textarea",placeholder:"请输入备注信息",rows:3},null,8,["modelValue"])])])]),_:1},8,["modelValue","title"]),t(A,{modelValue:U.value,"onUpdate:modelValue":e[10]||(e[10]=s=>U.value=s),title:"导入规则",width:"500px",onConfirm:X,onCancel:Y,confirmLoading:S.value},{default:m(()=>[l("div",_e,[l("div",ze,[e[26]||(e[26]=l("label",null,"选择文件",-1)),t(oe,{modelValue:d.value,"onUpdate:modelValue":e[9]||(e[9]=s=>d.value=s),accept:".xlsx,.xls",maxSize:10,placeholder:"请选择Excel文件",onError:le},null,8,["modelValue"])])])]),_:1},8,["modelValue","confirmLoading"])])}}}),Ee=me(Se,[["__scopeId","data-v-3aefa69a"]]);export{Ee as default};
//# sourceMappingURL=RulesView-CRV7vDAW.js.map
