import{d as te,a as i,x as D,y as ne,b as c,e as l,g as t,w as m,F as L,f as E,A as re,r as b,o as p,i as g,t as f,n as de,c as ie,l as N}from"./vue-vendor-hvhEjQgQ.js";import{r as h}from"./underwriting-WGKpY2Tf.js";import{s as ue,_ as me}from"./index-soUPKp6E.js";const pe={class:"rules-page"},ce={class:"page-header"},ve={class:"header-actions"},ge={class:"search-bar"},fe={class:"rules-table"},ye={key:0,class:"loading-wrapper"},Ve={key:1,class:"empty-state"},we={key:2},ke={class:"action-buttons"},Ce={class:"pagination"},he={class:"form"},Re={class:"form-item"},xe={key:0,class:"form-error"},be={class:"form-item"},Be={key:0,class:"form-error"},Ue={class:"form-item"},_e={class:"form"},ze={class:"form-item"},Se=te({__name:"RulesView",props:{confirmLoading:{type:Boolean,default:!1},onNodeUnmounted:{type:Function,default:()=>{}}},setup(Ie){const M=re(),z=i(!1),B=i(!1),U=i(!1),y=i("add"),d=i(null),S=i(!1),n=D({name:"",version:"",remark:""}),V=D({name:"",version:""}),v=i(""),O=[{label:"å·²å¯¼å…¥",value:"å·²å¯¼å…¥"},{label:"å·²å¯ç”¨",value:"å·²å¯ç”¨"},{label:"å·²ç¦ç”¨",value:"å·²ç¦ç”¨"}],F=i([]),r=D({name:"",status:void 0,diseaseCategory:void 0,page:1,pageSize:10}),I=i(1),$=i(10),_=i(0),R=i([]),o=a=>{ue(a.type,a.message)},w=async()=>{console.log("å¼€å§‹åŠ è½½æ ¸ä¿è§„åˆ™åˆ—è¡¨:",r),z.value=!0;try{const a=await h.getRules(r);console.log("æ ¸ä¿è§„åˆ™å“åº”:",a),a.code===200?(R.value=a.data.list||[],_.value=a.data.total||0,console.log("æ ¸ä¿è§„åˆ™åŠ è½½æˆåŠŸ:",{list:R.value,total:_.value})):(console.error("åŠ è½½æ ¸ä¿è§„åˆ™å¤±è´¥:",a.message),o({type:"error",message:a.message||"åŠ è½½å¤±è´¥"}),R.value=[],_.value=0)}catch(a){console.error("åŠ è½½æ ¸ä¿è§„åˆ™åˆ—è¡¨å¤±è´¥:",a),o({type:"error",message:a.message||"åŠ è½½å¤±è´¥"}),R.value=[],_.value=0}finally{z.value=!1}},T=async()=>{try{const a=await h.getDiseaseCategories("all");a.code===200&&a.data?F.value=a.data.map(e=>({label:e.name,value:e.code})):o({type:"error",message:a.message||"èŽ·å–ç–¾ç—…ç±»åˆ«å¤±è´¥"})}catch{o({type:"error",message:"èŽ·å–ç–¾ç—…ç±»åˆ«å¤±è´¥"})}},P=()=>{r.page=1,w()},j=()=>{r.name="",r.status=void 0,r.diseaseCategory=void 0,r.page=1,w()},Q=()=>{r.page=I.value,r.pageSize=$.value,w()},q=()=>{y.value="add",n.name="",n.version="",n.remark="",B.value=!0},G=a=>{y.value="edit",v.value=a.id,n.name=a.name,n.version=a.version,n.remark=a.remark||"",B.value=!0},H=a=>{console.log("[RulesView] ç‚¹å‡»æŸ¥çœ‹æŒ‰é’®:",{id:a.id,name:a.name,version:a.version}),M.push(`/underwriting/rules/${a.id}/detail`)},J=a=>{console.log("[RulesView] ç‚¹å‡»æŸ¥çœ‹è§„åˆ™æŒ‰é’®:",{id:a.id,name:a.name,version:a.version}),M.push(`/underwriting/rules/${a.id}/detail`)},K=async a=>{try{const e=await h.exportRuleData(a.id);if(e.code===200&&e.data){const u=new Blob([e.data],{type:"application/vnd.ms-excel"}),k=window.URL.createObjectURL(u),x=document.createElement("a");x.href=k,x.download=`${a.name}-${a.version}.xlsx`,x.click(),window.URL.revokeObjectURL(k),o({type:"success",message:"å¯¼å‡ºæˆåŠŸ"})}else o({type:"error",message:e.message||"å¯¼å‡ºå¤±è´¥"})}catch{o({type:"error",message:"å¯¼å‡ºå¤±è´¥"})}},W=a=>{console.log("[RulesView] ç‚¹å‡»å¯¼å…¥æŒ‰é’®:",{id:a.id,name:a.name,version:a.version}),v.value=a.id,d.value=null,U.value=!0},X=async()=>{var a;if(console.log("[RulesView] ç¡®è®¤å¯¼å…¥:",{ruleId:v.value,hasFile:!!d.value,fileName:(a=d.value)==null?void 0:a.name}),!d.value){o({type:"error",message:"è¯·é€‰æ‹©è¦å¯¼å…¥çš„æ–‡ä»¶"});return}if(!v.value){o({type:"error",message:"æœªæ‰¾åˆ°è§„åˆ™ID"});return}try{S.value=!0,console.log("[RulesView] å¼€å§‹å¯¼å…¥è§„åˆ™æ•°æ®:",{ruleId:v.value,fileName:d.value.name,fileSize:d.value.size,fileType:d.value.type});const e=await h.importRuleData(v.value,d.value);console.log("[RulesView] å¯¼å…¥å“åº”:",{code:e.code,message:e.message}),e.code===200?(o({type:"success",message:"å¯¼å…¥æˆåŠŸ"}),U.value=!1,d.value=null,v.value="",await w()):o({type:"error",message:e.message||"å¯¼å…¥å¤±è´¥"})}catch(e){console.error("[RulesView] å¯¼å…¥å¤±è´¥:",e),o({type:"error",message:(e==null?void 0:e.message)||"å¯¼å…¥å¤±è´¥"})}finally{S.value=!1}},Y=()=>{console.log("[RulesView] å–æ¶ˆå¯¼å…¥"),U.value=!1,d.value=null,v.value=""},Z=async()=>{if(V.name=n.name?"":"è¯·è¾“å…¥è§„åˆ™åç§°",V.version=n.version?"":"è¯·è¾“å…¥ç‰ˆæœ¬å·",!(V.name||V.version))try{let a;y.value==="add"?a=await h.createRule(n):a=await h.updateRule(v.value,n),a.code===200?(o({type:"success",message:y.value==="add"?"æ–°å¢žæˆåŠŸ":"ç¼–è¾‘æˆåŠŸ"}),B.value=!1,w()):o({type:"error",message:a.message||(y.value==="add"?"æ–°å¢žå¤±è´¥":"ç¼–è¾‘å¤±è´¥")})}catch{o({type:"error",message:y.value==="add"?"æ–°å¢žå¤±è´¥":"ç¼–è¾‘å¤±è´¥"})}},ee=async a=>{try{if(!confirm(`ç¡®è®¤åˆ é™¤è§„åˆ™"${a.name}"å—ï¼Ÿ`))return;console.log("[RulesView] å¼€å§‹åˆ é™¤è§„åˆ™:",{id:a.id,name:a.name}),(await h.deleteRule(a.id)).code===200&&(o({type:"success",message:"åˆ é™¤æˆåŠŸ"}),w())}catch(e){console.error("[RulesView] åˆ é™¤è§„åˆ™å¤±è´¥:",e),o({type:"error",message:"åˆ é™¤å¤±è´¥"})}},ae=a=>{switch(a){case"å·²å¯ç”¨":return"success";case"å·²å¯¼å…¥":return"processing";case"è‰ç¨¿":return"default";case"å·²ç¦ç”¨":return"error";default:return"default"}},le=a=>{console.log("[RulesView] æ–‡ä»¶ä¸Šä¼ é”™è¯¯:",a),o({type:"error",message:a.message})};return ne(()=>{w(),T()}),(a,e)=>{const u=b("BaseButton"),k=b("BaseInput"),x=b("BaseSelect"),se=b("BasePagination"),A=b("BaseModal"),oe=b("BaseUpload");return p(),c("div",pe,[l("div",ce,[e[12]||(e[12]=l("h1",null,"æ ¸ä¿è§„åˆ™ç®¡ç†",-1)),l("div",ve,[t(u,{type:"primary",onClick:q},{default:m(()=>e[11]||(e[11]=[g("æ–°å¢žè§„åˆ™")])),_:1})])]),l("div",ge,[t(k,{modelValue:r.name,"onUpdate:modelValue":e[0]||(e[0]=s=>r.name=s),placeholder:"æœç´¢è§„åˆ™åç§°",style:{width:"300px"}},null,8,["modelValue"]),t(x,{modelValue:r.status,"onUpdate:modelValue":e[1]||(e[1]=s=>r.status=s),options:O,placeholder:"è§„åˆ™çŠ¶æ€",style:{width:"200px"}},null,8,["modelValue"]),t(x,{modelValue:r.diseaseCategory,"onUpdate:modelValue":e[2]||(e[2]=s=>r.diseaseCategory=s),options:F.value,placeholder:"ç–¾ç—…ç±»åˆ«",style:{width:"200px"}},null,8,["modelValue","options"]),t(u,{onClick:P},{default:m(()=>e[13]||(e[13]=[g("æœç´¢")])),_:1}),t(u,{onClick:j},{default:m(()=>e[14]||(e[14]=[g("é‡ç½®")])),_:1})]),l("div",fe,[z.value?(p(),c("div",ye,[(p(),c(L,null,E(5,s=>l("div",{class:"skeleton-row",key:s},[(p(),c(L,null,E(6,C=>l("div",{class:"skeleton-cell",key:C})),64))])),64))])):R.value.length?(p(),c("table",we,[e[22]||(e[22]=l("thead",null,[l("tr",null,[l("th",null,"ID"),l("th",null,"æ ¸ä¿è§„åˆ™åç§°"),l("th",null,"æ ¸ä¿è§„åˆ™ç‰ˆæœ¬"),l("th",null,"è§„åˆ™çŠ¶æ€"),l("th",null,"å¤‡æ³¨"),l("th",null,"åˆ›å»ºæ—¶é—´"),l("th",null,"ç¼–è¾‘æ—¶é—´"),l("th",null,"æ“ä½œ")])],-1)),l("tbody",null,[(p(!0),c(L,null,E(R.value,s=>(p(),c("tr",{key:s.id},[l("td",null,f(s.id),1),l("td",null,f(s.name),1),l("td",null,f(s.version),1),l("td",null,[l("span",{class:de(["status-badge",ae(s.status)])},f(s.status),3)]),l("td",null,f(s.remark||"-"),1),l("td",null,f(s.createdAt),1),l("td",null,f(s.updatedAt),1),l("td",null,[l("div",ke,[t(u,{size:"small",onClick:C=>H(s)},{default:m(()=>e[16]||(e[16]=[g("æŸ¥çœ‹")])),_:2},1032,["onClick"]),t(u,{size:"small",onClick:C=>J(s)},{default:m(()=>e[17]||(e[17]=[g("æŸ¥çœ‹è§„åˆ™")])),_:2},1032,["onClick"]),t(u,{size:"small",onClick:C=>G(s)},{default:m(()=>e[18]||(e[18]=[g("ç¼–è¾‘")])),_:2},1032,["onClick"]),t(u,{size:"small",onClick:C=>W(s)},{default:m(()=>e[19]||(e[19]=[g("å¯¼å…¥")])),_:2},1032,["onClick"]),s.has_data?(p(),ie(u,{key:0,size:"small",onClick:C=>K(s)},{default:m(()=>e[20]||(e[20]=[g("å¯¼å‡º")])),_:2},1032,["onClick"])):N("",!0),t(u,{size:"small",type:"danger",onClick:C=>ee(s)},{default:m(()=>e[21]||(e[21]=[g("åˆ é™¤")])),_:2},1032,["onClick"])])])]))),128))])])):(p(),c("div",Ve,e[15]||(e[15]=[l("span",{class:"icon"},"ðŸ“­",-1),l("p",null,"æš‚æ— æ•°æ®",-1)]))),l("div",Ce,[t(se,{current:I.value,"onUpdate:current":e[3]||(e[3]=s=>I.value=s),pageSize:$.value,"onUpdate:pageSize":e[4]||(e[4]=s=>$.value=s),total:_.value,onChange:Q},null,8,["current","pageSize","total"])])]),t(A,{modelValue:B.value,"onUpdate:modelValue":e[8]||(e[8]=s=>B.value=s),title:y.value==="add"?"æ–°å¢žè§„åˆ™":"ç¼–è¾‘è§„åˆ™",width:"500px",onConfirm:Z},{default:m(()=>[l("div",he,[l("div",Re,[e[23]||(e[23]=l("label",null,"è§„åˆ™åç§°",-1)),t(k,{modelValue:n.name,"onUpdate:modelValue":e[5]||(e[5]=s=>n.name=s),placeholder:"è¯·è¾“å…¥è§„åˆ™åç§°",maxlength:50},null,8,["modelValue"]),V.name?(p(),c("div",xe,f(V.name),1)):N("",!0)]),l("div",be,[e[24]||(e[24]=l("label",null,"ç‰ˆæœ¬å·",-1)),t(k,{modelValue:n.version,"onUpdate:modelValue":e[6]||(e[6]=s=>n.version=s),placeholder:"è¯·è¾“å…¥ç‰ˆæœ¬å·",maxlength:30,disabled:y.value==="edit"},null,8,["modelValue","disabled"]),V.version?(p(),c("div",Be,f(V.version),1)):N("",!0)]),l("div",Ue,[e[25]||(e[25]=l("label",null,"å¤‡æ³¨",-1)),t(k,{modelValue:n.remark,"onUpdate:modelValue":e[7]||(e[7]=s=>n.remark=s),type:"textarea",placeholder:"è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯",rows:3},null,8,["modelValue"])])])]),_:1},8,["modelValue","title"]),t(A,{modelValue:U.value,"onUpdate:modelValue":e[10]||(e[10]=s=>U.value=s),title:"å¯¼å…¥è§„åˆ™",width:"500px",onConfirm:X,onCancel:Y,confirmLoading:S.value},{default:m(()=>[l("div",_e,[l("div",ze,[e[26]||(e[26]=l("label",null,"é€‰æ‹©æ–‡ä»¶",-1)),t(oe,{modelValue:d.value,"onUpdate:modelValue":e[9]||(e[9]=s=>d.value=s),accept:".xlsx,.xls",maxSize:10,placeholder:"è¯·é€‰æ‹©Excelæ–‡ä»¶",onError:le},null,8,["modelValue"])])])]),_:1},8,["modelValue","confirmLoading"])])}}}),Ee=me(Se,[["__scopeId","data-v-3aefa69a"]]);export{Ee as default};
//# sourceMappingURL=RulesView-CRV7vDAW.js.map
