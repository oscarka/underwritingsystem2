import{u as he}from"./useMessage-Cc080yAV.js";import{_ as le,u as be,g as M,p as we,a as ke,d as Ve}from"./index-CMftDAuZ.js";import{d as ne,o as p,b as m,e as l,t as u,l as B,u as Ce,g as i,aw as ae,a as y,x as Y,y as Ae,w as $,F as D,f as ee,r as H,i as E,n as Be}from"./vue-vendor-hvhEjQgQ.js";const xe={key:0,class:"base-dialog__header"},Pe=["innerHTML"],Ie={class:"base-dialog__footer"},Te=ne({__name:"BaseDialog",props:{title:{},content:{},confirmText:{default:"确定"},cancelText:{default:"取消"},showCancel:{type:Boolean,default:!1},closeOnClickOverlay:{type:Boolean,default:!0}},emits:["close","confirm","cancel"],setup(Q,{emit:R}){const L=Q,T=R;function f(){T("confirm"),T("close")}function Z(){T("cancel"),T("close")}function j(){L.closeOnClickOverlay&&T("close")}return(b,O)=>(p(),m("div",{class:"base-dialog-overlay",onClick:j},[l("div",{class:"base-dialog",onClick:O[0]||(O[0]=Ce(()=>{},["stop"]))},[b.title?(p(),m("div",xe,u(b.title),1)):B("",!0),l("div",{class:"base-dialog__content",innerHTML:b.content},null,8,Pe),l("div",Ie,[b.showCancel?(p(),m("button",{key:0,class:"base-dialog__btn base-dialog__btn--cancel",onClick:Z},u(b.cancelText),1)):B("",!0),l("button",{class:"base-dialog__btn base-dialog__btn--confirm",onClick:f},u(b.confirmText),1)])])]))}}),Ue=le(Te,[["__scopeId","data-v-dd1d73df"]]);let G=null;const $e={show(Q){G||(G=document.createElement("div"),document.body.appendChild(G));const R=i(Ue,{...Q,onClose:()=>{ae(null,G)}});ae(R,G)}},Le={class:"product-config-page"},Oe={class:"page-header"},ze={class:"search-bar"},Se={class:"product-table"},Me={key:0,class:"loading-wrapper"},Ee={key:1,class:"empty-state"},Re={key:2},Ne={class:"operation-column"},Fe={class:"pagination"},qe={class:"form"},He={class:"form-item"},Ge={key:0,class:"form-error"},Qe={class:"form-item"},Ze={key:0,class:"form-error"},je={class:"form-item"},Je={key:0,class:"form-error"},Ke={class:"form-item"},We={key:0,class:"form-error"},Xe={class:"form-item"},Ye={key:0,class:"form-error"},De={class:"form-item"},eo={key:0,class:"form-error"},oo={class:"form-item"},ao={class:"form-item"},lo={key:0,class:"form-error"},no=ne({__name:"ProductConfigView",setup(Q){const R=y("http://localhost:3001");function L(){return localStorage.getItem("token")}function T(){return!!L()}const f=he(),Z=y([]),j=y([]),b=y([]),O=y([]),te=async()=>{var e,c,_,d,C,A,n,r,h;const a=L();console.log("[选项加载] ===== 开始加载选项数据 ====="),console.log("[选项加载] 认证信息:",{tokenExists:!!a,tokenLength:(a==null?void 0:a.length)||0});try{console.log("准备请求渠道数据");const s=await M("/api/v1/business/channels"),k=s.data;console.log("渠道数据响应:",{code:s.code,message:s.message,dataLength:(e=k==null?void 0:k.list)==null?void 0:e.length}),k!=null&&k.list&&Array.isArray(k.list)&&(Z.value=k.list.map(g=>({value:g.id,label:g.name}))),console.log("准备请求保险公司数据");const S=await M("/api/v1/business/companies"),V=S.data;console.log("保险公司数据响应:",{code:S.code,message:S.message,dataLength:(c=V==null?void 0:V.list)==null?void 0:c.length}),V!=null&&V.list&&Array.isArray(V.list)&&(j.value=V.list.map(g=>({value:g.id,label:g.name}))),console.log("[选项加载] 开始请求产品类型数据");const q=await M("/api/v1/business/product-types");console.log("[选项加载] 产品类型API响应:",q);const P=q.data;console.log("[选项加载] 产品类型原始数据:",P),P!=null&&P.list&&Array.isArray(P.list)?b.value=P.list.map(g=>({value:g.id,label:g.name})):Array.isArray(P)&&(b.value=P.map(g=>({value:g.id,label:g.name}))),console.log("[选项加载] 处理后的产品类型选项:",b.value),console.log("准备请求AI参数数据");const X=await M("/api/v1/underwriting/ai-parameter/"),I=X.data;console.log("AI参数数据响应:",{code:X.code,message:X.message,dataLength:(_=I==null?void 0:I.list)==null?void 0:_.length}),I!=null&&I.list&&Array.isArray(I.list)&&(O.value=I.list.map(g=>({value:g.id,label:g.name})))}catch(s){console.error("[选项加载] 加载失败:",{error:s,name:s.name,message:s.message,response:{status:(d=s.response)==null?void 0:d.status,statusText:(C=s.response)==null?void 0:C.statusText,data:(A=s.response)==null?void 0:A.data},request:{method:(n=s.config)==null?void 0:n.method,url:(r=s.config)==null?void 0:r.url,headers:(h=s.config)==null?void 0:h.headers}}),f.error(s.message||"加载选项数据失败")}console.log("[选项加载] ===== 加载选项数据结束 =====")},v=Y({name:"",code:"",status:void 0}),oe=[{value:"enabled",label:"启用"},{value:"disabled",label:"禁用"}],N=y(1),J=y(10),x=y(0),w=y([]),K=y(!1),z=y(!1),F=y("add"),W=y(),o=Y({name:"",product_code:"",product_type_id:void 0,insurance_company_id:void 0,channel_id:void 0,ai_parameter_id:void 0,underwriting_rule:"",status:"enabled"}),t=Y({name:"",product_code:"",channel_id:"",insurance_company_id:"",product_type_id:"",ai_parameter_id:"",status:""}),{copy:se}=be(),U=async()=>{var e,c,_,d,C,A,n;const a=L();console.log("[产品列表] ===== 开始加载产品配置数据 ====="),console.log("[产品列表] 认证信息:",{tokenExists:!!a,tokenLength:(a==null?void 0:a.length)||0});try{K.value=!0;const r={page:N.value,pageSize:J.value,name:v.name||void 0,code:v.code||void 0,status:v.status};console.log("[产品列表] 请求参数:",r),console.log("[产品列表] 发起API请求...");const h=await M("/api/v1/business/products",{params:r});if(console.log("[产品列表] API响应原始数据:",h),!h)throw console.error("[产品列表] API响应为空"),new Error("获取数据失败");if(h.code!==200)throw console.error("[产品列表] API响应状态码异常:",h.code),new Error(h.message||"获取数据失败");const s=h.data;if(console.log("[产品列表] 解析后的数据:",s),!s){console.error("[产品列表] 响应数据为空"),w.value=[],x.value=0;return}s.list&&Array.isArray(s.list)?(console.log("[产品列表] 数据格式正确，包含list数组"),w.value=s.list,x.value=s.total||0,console.log("[产品列表] 更新后的状态:",{listLength:w.value.length,total:x.value,firstItem:w.value[0]})):Array.isArray(s)?(console.log("[产品列表] 数据直接是数组格式"),w.value=s,x.value=s.length,console.log("[产品列表] 更新后的状态:",{listLength:w.value.length,total:x.value,firstItem:w.value[0]})):(console.error("[产品列表] 数据格式异常:",s),w.value=[],x.value=0)}catch(r){console.error("[产品列表] 加载失败:",{error:r,name:r.name,message:r.message,response:{status:(e=r.response)==null?void 0:e.status,statusText:(c=r.response)==null?void 0:c.statusText,data:(_=r.response)==null?void 0:_.data},request:{method:(d=r.config)==null?void 0:d.method,url:(C=r.config)==null?void 0:C.url,headers:(A=r.config)==null?void 0:A.headers,params:(n=r.config)==null?void 0:n.params}}),f.error(r.message||"加载数据失败，请重试"),w.value=[],x.value=0}finally{K.value=!1,console.log("[产品列表] ===== 加载产品配置数据结束 =====")}};function re(){console.log("[产品列表] 执行搜索，搜索条件:",v),N.value=1,U()}function de(){console.log("[产品列表] 执行重置"),v.name="",v.code="",v.status=void 0,N.value=1,U()}function ie(){U()}function ue(){let a=!0;return t.name="",t.product_code="",t.channel_id="",t.insurance_company_id="",t.product_type_id="",t.ai_parameter_id="",t.status="",o.name?o.name.length>50&&(t.name="产品名称不能超过50个字符",a=!1):(t.name="请输入产品名称",a=!1),o.product_code?o.product_code.length>30?(t.product_code="产品代码不能超过30个字符",a=!1):/^[A-Z0-9_]+$/.test(o.product_code)||(t.product_code="产品代码只能包含大写字母、数字和下划线",a=!1):(t.product_code="请输入产品代码",a=!1),o.channel_id||(t.channel_id="请选择所属渠道",a=!1),o.insurance_company_id||(t.insurance_company_id="请选择承保公司",a=!1),o.product_type_id||(t.product_type_id="请选择产品类型",a=!1),o.ai_parameter_id||(t.ai_parameter_id="请选择智核参数",a=!1),o.status||(t.status="请选择状态",a=!1),a}function ce(){F.value="add",o.name="",o.product_code="",o.product_type_id=void 0,o.insurance_company_id=void 0,o.channel_id=void 0,o.ai_parameter_id=void 0,o.status="enabled",z.value=!0}function pe(a){var e,c,_,d,C,A;F.value="edit",W.value=a.id,o.name=a.name,o.product_code=a.code,o.product_type_id=(e=a.productType)==null?void 0:e.id,o.insurance_company_id=(c=a.insuranceCompany)==null?void 0:c.id,o.channel_id=(_=a.channel)==null?void 0:_.id,o.ai_parameter_id=(d=a.aiParameter)==null?void 0:d.id,o.underwriting_rule=((A=(C=a.aiParameter)==null?void 0:C.rule)==null?void 0:A.name)||"",o.status=a.status,z.value=!0}async function me(){if(ue())try{F.value==="add"?await _e():await fe()}catch(a){console.error("保存失败:",a),f.error("保存失败，请重试")}}async function _e(){try{const a=await we("/api/v1/business/products",{name:o.name,product_code:o.product_code,product_type_id:o.product_type_id,insurance_company_id:o.insurance_company_id,channel_id:o.channel_id,ai_parameter_id:o.ai_parameter_id,status:o.status});f.success("创建成功"),z.value=!1,U()}catch(a){console.error("创建产品失败:",a),f.error(a.message||"创建失败，请重试")}}async function fe(){if(W.value)try{const a=await ke(`/api/v1/business/products/${W.value}`,{name:o.name,product_code:o.product_code,product_type_id:o.product_type_id,insurance_company_id:o.insurance_company_id,channel_id:o.channel_id,ai_parameter_id:o.ai_parameter_id,status:o.status});f.success("更新成功"),z.value=!1,U()}catch(a){console.error("更新产品失败:",a),f.error(a.message||"更新失败，请重试")}}async function ge(a){try{await f.confirm(`确认删除产品"${a.name}"吗？`);const e=await Ve(`/api/v1/business/products/${a.id}`);f.success("删除成功"),U()}catch(e){if(e==="cancel")return;console.error("删除产品失败:",e),f.error(e.message||"删除失败，请重试")}}async function ve(a){var e,c;if(console.log("[智核参数] 参数变更:",a),o.underwriting_rule="",!!a)try{if(O.value.find(d=>d.value===a)){const d=await M(`/api/v1/underwriting/ai-parameter/${a}`);console.log("[智核参数] 获取规则信息:",d),(c=(e=d.data)==null?void 0:e.rule)!=null&&c.name&&(o.underwriting_rule=d.data.rule.name)}}catch(_){console.error("[智核参数] 获取规则信息失败:",_)}}async function ye(a){try{const e=`${R.value}/product/${a.id}`;await se(e),f.success("链接已复制到剪贴板"),$e.show({title:"移动核保链接",content:`
        <div style="word-break: break-all;">
          <p>产品名称: ${a.name}</p>
          <p>链接地址: ${e}</p>
          <p style="color: #666; font-size: 14px;">提示: 链接已自动复制到剪贴板</p>
        </div>
      `,confirmText:"确定"})}catch(e){console.error("生成链接失败:",e),f.error("生成链接失败")}}return Ae(async()=>{var a;console.log("[产品列表] ===== 组件挂载 ====="),console.log("[产品列表] 初始认证状态:",{token:((a=L())==null?void 0:a.slice(0,10))+"...",isLoggedIn:T()}),await te(),await U()}),(a,e)=>{const c=H("BaseButton"),_=H("BaseInput"),d=H("BaseSelect"),C=H("BasePagination"),A=H("BaseModal");return p(),m("div",Le,[l("div",Oe,[e[15]||(e[15]=l("h1",null,"产品配置",-1)),i(c,{type:"primary",onClick:ce},{default:$(()=>e[14]||(e[14]=[E("新增产品")])),_:1})]),l("div",ze,[i(_,{modelValue:v.name,"onUpdate:modelValue":e[0]||(e[0]=n=>v.name=n),placeholder:"搜索产品名称",style:{width:"300px"}},null,8,["modelValue"]),i(_,{modelValue:v.code,"onUpdate:modelValue":e[1]||(e[1]=n=>v.code=n),placeholder:"搜索产品代码",style:{width:"200px"}},null,8,["modelValue"]),i(d,{modelValue:v.status,"onUpdate:modelValue":e[2]||(e[2]=n=>v.status=n),options:oe,placeholder:"状态筛选",style:{width:"200px"}},null,8,["modelValue"]),i(c,{onClick:re},{default:$(()=>e[16]||(e[16]=[E("搜索")])),_:1}),i(c,{onClick:de},{default:$(()=>e[17]||(e[17]=[E("重置")])),_:1})]),l("div",Se,[K.value?(p(),m("div",Me,[(p(),m(D,null,ee(5,n=>l("div",{class:"skeleton-row",key:n},[(p(),m(D,null,ee(6,r=>l("div",{class:"skeleton-cell",key:r})),64))])),64))])):w.value.length?(p(),m("table",Re,[e[22]||(e[22]=l("thead",null,[l("tr",null,[l("th",null,"产品名称"),l("th",null,"产品代码"),l("th",null,"所属渠道"),l("th",null,"承保公司"),l("th",null,"产品类型"),l("th",null,"智核参数"),l("th",null,"核保规则"),l("th",null,"状态"),l("th",null,"创建时间"),l("th",null,"操作")])],-1)),l("tbody",null,[(p(!0),m(D,null,ee(w.value,n=>{var r,h,s,k,S,V;return p(),m("tr",{key:n.id},[l("td",null,u(n.name),1),l("td",null,u(n.code),1),l("td",null,u(((r=n.channel)==null?void 0:r.name)||"-"),1),l("td",null,u(((h=n.insuranceCompany)==null?void 0:h.name)||"-"),1),l("td",null,u(((s=n.productType)==null?void 0:s.name)||"-"),1),l("td",null,u(((k=n.aiParameter)==null?void 0:k.name)||"-"),1),l("td",null,u(((V=(S=n.aiParameter)==null?void 0:S.rule)==null?void 0:V.name)||"-"),1),l("td",null,[l("span",{class:Be(["status-badge",n.status])},u(n.status==="enabled"?"启用":"禁用"),3)]),l("td",null,u(n.createdAt),1),l("td",Ne,[i(c,{size:"small",onClick:q=>pe(n)},{default:$(()=>e[19]||(e[19]=[E("编辑")])),_:2},1032,["onClick"]),i(c,{size:"small",type:"danger",onClick:q=>ge(n)},{default:$(()=>e[20]||(e[20]=[E("删除")])),_:2},1032,["onClick"]),i(c,{size:"small",type:"primary",onClick:q=>ye(n),disabled:n.status!=="enabled"},{default:$(()=>e[21]||(e[21]=[E("生成链接")])),_:2},1032,["onClick","disabled"])])])}),128))])])):(p(),m("div",Ee,e[18]||(e[18]=[l("span",{class:"icon"},"📭",-1),l("p",null,"暂无数据",-1)]))),l("div",Fe,[i(C,{current:N.value,"onUpdate:current":e[3]||(e[3]=n=>N.value=n),pageSize:J.value,"onUpdate:pageSize":e[4]||(e[4]=n=>J.value=n),total:x.value,onChange:ie},null,8,["current","pageSize","total"])])]),i(A,{modelValue:z.value,"onUpdate:modelValue":e[13]||(e[13]=n=>z.value=n),title:F.value==="add"?"新增产品":"编辑产品",width:"500px",onConfirm:me},{default:$(()=>[l("div",qe,[l("div",He,[e[23]||(e[23]=l("label",null,"产品名称",-1)),i(_,{modelValue:o.name,"onUpdate:modelValue":e[5]||(e[5]=n=>o.name=n),placeholder:"请输入产品名称",maxlength:50},null,8,["modelValue"]),t.name?(p(),m("div",Ge,u(t.name),1)):B("",!0)]),l("div",Qe,[e[24]||(e[24]=l("label",null,"产品代码",-1)),i(_,{modelValue:o.product_code,"onUpdate:modelValue":e[6]||(e[6]=n=>o.product_code=n),placeholder:"请输入产品代码",maxlength:30,disabled:F.value==="edit"},null,8,["modelValue","disabled"]),t.product_code?(p(),m("div",Ze,u(t.product_code),1)):B("",!0)]),l("div",je,[e[25]||(e[25]=l("label",null,"所属渠道",-1)),i(d,{modelValue:o.channel_id,"onUpdate:modelValue":e[7]||(e[7]=n=>o.channel_id=n),options:Z.value,placeholder:"请选择所属渠道"},null,8,["modelValue","options"]),t.channel_id?(p(),m("div",Je,u(t.channel_id),1)):B("",!0)]),l("div",Ke,[e[26]||(e[26]=l("label",null,"承保公司",-1)),i(d,{modelValue:o.insurance_company_id,"onUpdate:modelValue":e[8]||(e[8]=n=>o.insurance_company_id=n),options:j.value,placeholder:"请选择承保公司"},null,8,["modelValue","options"]),t.insurance_company_id?(p(),m("div",We,u(t.insurance_company_id),1)):B("",!0)]),l("div",Xe,[e[27]||(e[27]=l("label",null,"产品类型",-1)),i(d,{modelValue:o.product_type_id,"onUpdate:modelValue":e[9]||(e[9]=n=>o.product_type_id=n),options:b.value,placeholder:"请选择产品类型"},null,8,["modelValue","options"]),t.product_type_id?(p(),m("div",Ye,u(t.product_type_id),1)):B("",!0)]),l("div",De,[e[28]||(e[28]=l("label",null,"智核参数",-1)),i(d,{modelValue:o.ai_parameter_id,"onUpdate:modelValue":e[10]||(e[10]=n=>o.ai_parameter_id=n),options:O.value,placeholder:"请选择智核参数",onChange:ve},null,8,["modelValue","options"]),t.ai_parameter_id?(p(),m("div",eo,u(t.ai_parameter_id),1)):B("",!0)]),l("div",oo,[e[29]||(e[29]=l("label",null,"核保规则",-1)),i(_,{modelValue:o.underwriting_rule,"onUpdate:modelValue":e[11]||(e[11]=n=>o.underwriting_rule=n),placeholder:"选择智核参数后自动显示",disabled:""},null,8,["modelValue"])]),l("div",ao,[e[30]||(e[30]=l("label",null,"状态",-1)),i(d,{modelValue:o.status,"onUpdate:modelValue":e[12]||(e[12]=n=>o.status=n),options:oe,placeholder:"请选择状态"},null,8,["modelValue"]),t.status?(p(),m("div",lo,u(t.status),1)):B("",!0)])])]),_:1},8,["modelValue","title"])])}}}),io=le(no,[["__scopeId","data-v-36a8d43c"]]);export{io as default};
//# sourceMappingURL=ProductConfigView-DEoEVyMr.js.map
